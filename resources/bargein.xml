<?xml version="1.0"?>
<scxml initial="main">
	<state id="main">
		<invoke id="tts" type="scxml">
			<content>
				<scxml>
					<state id="root">
						<datamodel>
							<data id="grammar">
							<![CDATA[
							#JSGF V1.0;
							grammar bargin;
							public <top> = hello;
							]]>	
							</data>
						</datamodel>
						<invoke id="tts2" type="x-tts" />
						<invoke id="asr" type="x-asr" />
						
						<state id="init">
							<transition event="init.invoke.tts2" target="waiting">
							</transition>
						</state>
						
						<state id="waiting">
							<transition event="say" target="speaking">
								<send type="x-tts" target="#tts2">
									<param name="say" expr="_event.data.say" />
								</send>
								<send type="x-asr" target="#asr">
									<param name="grammar" />
								</send>
							</transition>
						</state>
						<state id="speaking">
							<transition event="result.invoke.asr">
								<send event="abort" type="x-tts" target="#tts2"  />
								<send target="#_parent" event="result.invoke.asr">
									<param name="lastResult" expr="_event.data.lastResult" />
								</send>
							</transition>
							
							<transition event="result.invoke.tts" target="waiting" />
						</state>
					</state>
				</scxml>
			</content>
		</invoke>

		<state id="initializing">
			<transition event="init.invoke.tts" target="talk">
				<log expr="'init.invoke.tts transition taken'" />
			</transition>
			
		</state>
		<state id="talk">
			<onentry>
				<send target="#tts" event="say">
					<param name="say" expr="'hello, please interrupt me while I have a long exposition about the theory of everything and then go on to talk some more about what\'s on my mind.'" />
				</send>
			</onentry>
			<transition event="result.invoke.tts" target="talk"/>
			<transition event="result.invoke.asr" >
				<log expr="'you said: ' + _event.data.lastResult" />
			</transition>
		</state>


	</state>

	<final id="f" />
</scxml>

